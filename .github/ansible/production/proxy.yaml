  - name: Deploy Production Nest Proxy
    hosts: production_nest_proxy
    tasks:
      - name: Copy proxy configuration files
        copy:
          src: '{{ github_workspace }}/proxy/{{ item }}'
          dest: ~/
          mode: '0644'
        loop:
          - blocked_ips.conf
          - cloudflare_realip.conf
          - docker-compose.yaml
          - headers.conf
          - production.conf
          - proxy_cache.conf
          - redirects.conf

      - name: Retart services
        shell:
          cmd: docker compose up -d --pull always

      - name: Prune docker images
        shell:
          cmd: docker image prune -f
